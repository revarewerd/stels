package ru.sosgps.wayrecall.avlprotocols.gosafe

import java.net.Socket
import ru.sosgps.wayrecall.utils.io.Utils
import java.io.{OutputStream, InputStream}

/**
 * Created by nickl on 18.03.14.
 */
object ClientTest {


  def readIs(is: InputStream): Stream[Array[Byte]] = {
    val buff = new Array[Byte](1024)

    def read(): Stream[Array[Byte]] = {
      val l = is.read(buff)
      if (l == -1)
        Stream.empty
      else
        buff.take(l) #:: read()
    }

    read()
  }


  def main(args: Array[String]) {

    val socket = new Socket("localhost", 9086)

    val bytes = Utils.asBytesHex("F802010357852034572894010E153AA8A6016177B906C2C9D9000103044000000004040000380B050401DC19B806080000000000000000070341077E080402FC4AB0733EF8")
    //val bytes = Utils.asBytesHex("f802010359394050225675020b0000000000fa01c018d60c030400020002050602101816231e0904270f0019061af8f802010359394050225675020b0000000000fa01c018d60c030400020002050602101816231e0904270f0019061af8f802010359394050225675020b0000000000fa01c018d60c030400020002050602101816231e0904270f0019020b0000000000fa01c018d60c03040002000205060210181623200904270f0019a551f8f802010359394050225675020b0000000000fa01c018d60c030400020002050602101816231e0904270f0019061af8f802010359394050225675020b0000000000fa01c018d60c030400020002050602101816231e0904270f0019061af8f802010359394050225675020b0000000000fa01c018d60c030400020002050602101816231e0904270f0019061af8f802010359394050225675020b0000000000fa01c018d60c030400020002050602101822231e0904270f00196ef7f8f802010359394050225675020b0000000000fa01c018d60c030400000002050602101822231c0904270f00192fd0f8f802010359394050225675020b0000000000fa01c018d60c030400000002050602101822231c0904270f00192fd0f8f802010359394050225675020b0000000000fa01c018d60c030400020002050602101816231d0904270f0019de98f8f802010359394050225675020b0000000000fa01c018d60c03040002000205060210180b231d0904270f0019d355f8f802010359394050225675020b0000000000fa01c018d60c03040002000205060210180b231c0904270f00196b34f8f802010359394050225675020b0000000000fa01c018d60c03040002000205060210180b231c0904270f00196b34f8f802010359394050225675020b0000000000fa01c018d60c03040002000205060210180b231c0904270f00196b34f8f802010359394050225675020b0000000000fa01c018d60c030400020002050602101816231a0904270f0019c7dcf8f802010359394050225675020b0000000000fa01c018d60c030400020002050602101816231e0904270f0019020b0000000000fa01c018d60c030400020002050602101816231e0904270f0019ce54f8f802010359394050225675020b0000000000fa01c018d60c030400020002050602101816231e0904270f0019061af8f802010359394050225675020b0000000000fa01c018d60c030400020002050602101816231e0904270f0019020b0000000000fa01c018d60c030400000002050602101816231f0904270f001957f1f8f802010359394050225675020b0000000000fa01c018d60c030400000002050602101816231f0904270f00199fbff8")
    val out = socket.getOutputStream

    out.write(bytes)

//    bytes.grouped(3).foreach(b => {
//      out.write(b)
//      out.flush()
//      //Thread.sleep(500)
//    })

    val is = socket.getInputStream

    readIs(is).foreach(b => println(Utils.toHexString(b, "")))

    socket.close()
  }

}
